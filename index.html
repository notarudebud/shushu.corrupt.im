<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>@shushu</title>
  <link rel="icon" type="image/x-icon" href="assets/top.ico">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="free will">
  <meta name="keywords" content="free will">
  <meta name="author" content="@shushu">
  <style>
    body {
      margin: 0;
      font-family: monospace, sans-serif;
      background: #f5f5f5;
      color: #111;
      transition: background 0.3s, color 0.3s;
    }

    header {
      background: #eee;
      padding: 10px;
      border-bottom: 1px solid #ccc;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 5px;
    }

    header a {
      color: inherit;
      text-decoration: none;
      font-weight: bold;
    }

    header a:hover {
      text-decoration: underline;
    }

    .dark-mode {
      background: #111;
      color: #eee;
    }
    .dark-mode header {
      background: #222;
      border-color: #444;
    }
    .dark-mode .post {
      background: #1c1c1c;
      border-color: #444;
    }
    .dark-mode .quoted {
      background: #2a2a2a;
      border-color: #555;
    }
    .dark-mode .loading,
    .dark-mode .notif {
      background: #222;
      color: #eee;
      border-color: #444;
    }
    .dark-mode button {
      background: #333;
      color: #eee;
      border-color: #666;
    }
    .dark-mode button:hover {
      background: #444;
    }
    .dark-mode textarea,
    .dark-mode input[type="text"] {
      background: #222;
      color: #eee;
      border-color: #555;
    }

    .container {
      max-width: 900px;
      margin: 10px auto;
      padding: 10px;
    }

    textarea, input[type="text"] {
      width: 100%;
      margin: 5px 0;
      padding: 8px;
      border: 1px solid #aaa;
      font-family: monospace;
      resize: none;
      box-sizing: border-box;
      transition: background 0.3s, color 0.3s, border-color 0.3s;
    }

    button {
      padding: 6px 12px;
      border: 1px solid #333;
      background: #ddd;
      cursor: pointer;
      font-family: monospace;
      margin-bottom: 15px;
    }
    button:hover {
      background: #ccc;
    }

    .post {
      background: #fff;
      padding: 10px;
      border: 1px solid #ccc;
      margin-bottom: 15px;
      width: 100%;
      box-sizing: border-box;
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 10px;
    }

    .post img {
      max-width: 180px;
      max-height: 180px;
      border: 1px solid #ddd;
    }

    .post-content {
      flex: 1;
    }

    .content {
      white-space: pre-wrap;
    }

    .meta {
      font-size: 12px;
      color: #555;
      margin-bottom: 5px;
    }

    .actions {
      font-size: 14px;
      white-space: nowrap;
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .actions span {
      cursor: pointer;
    }

    .quoted {
      border: 1px solid #ddd;
      padding: 8px;
      margin-top: 8px;
      background: #fafafa;
      font-size: 13px;
    }
    .quoted .meta {
      font-size: 11px;
      color: #777;
    }

    #notifications {
      position: fixed;
      top: 10px;
      right: 10px;
      display: flex;
      flex-direction: column;
      gap: 5px;
      z-index: 9999;
    }

    .notif {
      background: #fff;
      color: #111;
      padding: 10px 14px;
      font-size: 14px;
      border: 1px solid #ccc;
      box-shadow: 0 2px 5px rgba(0,0,0,0.15);
      opacity: 0;
      transform: translateX(100%);
      transition: all 0.3s ease-in-out;
      white-space: nowrap;
    }

    .notif.show {
      opacity: 1;
      transform: translateX(0);
    }

    .notif.hide {
      opacity: 0;
      transform: translateX(100%);
    }

    .loading {
      background: #fff;
      border: 1px solid #ccc;
      padding: 15px;
      text-align: center;
      font-size: 14px;
      font-style: italic;
      margin-bottom: 15px;
    }

    @media (max-width: 600px) {
      body { font-size: 14px; }
      .container { padding: 5px; }
      .post { font-size: 14px; flex-direction: column; align-items: flex-start; }
      .actions { font-size: 12px; }
      .post img { max-width: 100%; max-height: 200px; }
    }

    /* Modal styles */
    .modal-overlay {
      position: fixed;
      top:0; left:0;
      width:100%; height:100%;
      background: rgba(0,0,0,0.5);
      backdrop-filter: blur(3px);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 10000;
    }
    .modal {
      background: #fff;
      padding: 20px;
      border-radius: 10px;
      width: 300px;
      max-width: 90%;
      box-sizing: border-box;
    }
    .modal input[type="text"] {
      width: 100%;
      margin-top: 10px;
    }
    .modal button {
      margin-top: 10px;
    }
    .dark-mode .modal {
      background: #222;
      color: #eee;
      border: 1px solid #555;
    }
  </style>
</head>
<body>
<header>
  <a href="https://www.instagram.com/pizzawhiskers90/" target="_blank">@shushu ¬∑ embrace free will</a>
  <a href="https://shushu.corrupt.im/uses" target="_blank">our ToS (bullshit)</a>
  <button onclick="toggleDarkMode()">üåô</button>
</header>

<div class="container">
  <textarea id="postText" rows="3" placeholder="Type your message here..."></textarea>
  <input type="text" id="postImage" placeholder="Optional image URL">
  <input type="hidden" id="quoteIndex">
  <button onclick="createPost()">Upload</button>
  <button onclick="cancelQuote()">Cancel Quote</button>
  <div id="posts"></div>
</div>

<div id="notifications"></div>

<!-- Nickname Modal -->
<div class="modal-overlay" id="nicknameModal">
  <div class="modal">
    <h3>Change your nickname</h3>
    <input type="text" id="nicknameInput" placeholder="Enter nickname">
    <button onclick="saveNickname()">Save</button>
    <button onclick="closeNicknameModal()">Cancel</button>
  </div>
</div>

<script>
const BIN_ID = "68a8143bae596e708fd0dd3a";
const MASTER_KEY = "$2a$10$Ew3l92X5qMxwJsfdJsSLYOa1WF6nUZU9.FRLUUayL2W5WfxGVL9O6";

// Load darkmode preference
if(localStorage.getItem('darkMode') === 'true') {
  document.body.classList.add('dark-mode');
}

// Load nickname
let myNickname = localStorage.getItem('nickname') || null;

async function fetchPosts() {
  let postsDiv = document.getElementById("posts");
  postsDiv.innerHTML = `<div class="loading">give it a second.</div>`;
  try {
    let res = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`, {
      headers: { "X-Master-Key": MASTER_KEY }
    });
    let data = await res.json();
    let posts = data.record.posts || [];
    renderPosts(posts);
  } catch(e) {
    console.error("Error fetching:", e);
    postsDiv.innerHTML = `<div class="loading">Failed to load posts</div>`;
  }
}

async function savePosts(posts) {
  await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}`, {
    method: "PUT",
    headers: {
      "Content-Type": "application/json",
      "X-Master-Key": MASTER_KEY
    },
    body: JSON.stringify({ posts })
  });
}

async function createPost() {
  let text = document.getElementById("postText").value.trim();
  let image = document.getElementById("postImage").value.trim();
  let quoteIndex = document.getElementById("quoteIndex").value;
  if(!text && !image && !quoteIndex) return;

  let res = await fetch("https://api.ipify.org?format=json");
  let ip = (await res.json()).ip;

  let res2 = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`, {
    headers: { "X-Master-Key": MASTER_KEY }
  });
  let data = await res2.json();
  let posts = data.record.posts || [];

  posts.unshift({
    id: Date.now(),
    user: myNickname || ip,
    text,
    image: image || null,
    time: new Date().toISOString(),
    likes: [],
    dislikes: [],
    quote: quoteIndex !== "" ? quoteIndex : null
  });

  await savePosts(posts);
  document.getElementById("postText").value = "";
  document.getElementById("postImage").value = "";
  document.getElementById("quoteIndex").value = "";
  fetchPosts();
  showNotif("Posted!");
}

function renderPosts(posts) {
  let postsDiv = document.getElementById("posts");
  postsDiv.innerHTML = "";
  posts.forEach((p, i) => {
    let date = new Date(p.time);
    let dateStr = `${date.getMonth()+1}/${date.getDate()}, ${date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})} ${date.getFullYear()}`;
    
    let quotedHtml = "";
    if(p.quote) {
      let q = posts.find(x=>x.id==p.quote);
      if(q) {
        let qDate = new Date(q.time);
        let qDateStr = `${qDate.getMonth()+1}/${qDate.getDate()} ${qDate.getFullYear()}`;
        quotedHtml = `<div class="quoted"><div class="meta">@${q.user} ¬∑ ${qDateStr}</div><div class="content">${q.text||""}</div>${q.image?`<img src="${q.image}" style="max-width:120px;max-height:120px;">`:''}</div>`;
      }
    }

    let div = document.createElement("div");
    div.className="post";
    div.innerHTML=`
      <div class="post-content">
        <div class="meta">@${p.user} ¬∑ ${dateStr}</div>
        <div class="content">${p.text||""}</div>
        ${p.image?`<img src="${p.image}" alt="img">`:''}
        ${quotedHtml}
      </div>
      <div class="actions">
        <span onclick="likePost(${i})">üëç ${p.likes.length}</span>
        <span onclick="dislikePost(${i})">üëé ${p.dislikes.length}</span>
        <span onclick="quotePost(${i})">üí¨ Quote</span>
        <span onclick="deletePost(${i})" style="color:red;">üóëÔ∏è Delete</span>
      </div>
    `;
    postsDiv.appendChild(div);
  });
}

async function likePost(i) {
  let ip = (await (await fetch("https://api.ipify.org?format=json")).json()).ip;
  let res2 = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`, { headers: { "X-Master-Key": MASTER_KEY }});
  let data = await res2.json();
  let posts = data.record.posts || [];
  if(!posts[i]) return;
  posts[i].dislikes = posts[i].dislikes.filter(u=>u!==ip);
  if(!posts[i].likes.includes(ip)){posts[i].likes.push(ip); showNotif("Liked post");} else {posts[i].likes = posts[i].likes.filter(u=>u!==ip); showNotif("Unliked post");}
  await savePosts(posts); fetchPosts();
}

async function dislikePost(i) {
  let ip = (await (await fetch("https://api.ipify.org?format=json")).json()).ip;
  let res2 = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`, { headers: { "X-Master-Key": MASTER_KEY }});
  let data = await res2.json();
  let posts = data.record.posts || [];
  if(!posts[i]) return;
  posts[i].likes = posts[i].likes.filter(u=>u!==ip);
  if(!posts[i].dislikes.includes(ip)){posts[i].dislikes.push(ip); showNotif("Disliked post");} else {posts[i].dislikes = posts[i].dislikes.filter(u=>u!==ip); showNotif("Undisliked post");}
  await savePosts(posts); fetchPosts();
}

async function quotePost(i) {
  let res2 = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`, { headers: { "X-Master-Key": MASTER_KEY }});
  let data = await res2.json();
  let posts = data.record.posts || [];
  if(posts[i]){document.getElementById("quoteIndex").value=posts[i].id; showNotif("Quoting post..."); document.getElementById("postText").focus();}
}

function cancelQuote(){document.getElementById("quoteIndex").value=""; showNotif("Quote cancelled");}

async function deletePost(i){
  if(!confirm("Are you sure you want to delete this post?")) return;
  let res2 = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`, { headers: { "X-Master-Key": MASTER_KEY }});
  let data = await res2.json();
  let posts = data.record.posts || [];
  posts.splice(i,1); await savePosts(posts); fetchPosts(); showNotif("Post deleted");
}

function toggleDarkMode(){
  document.body.classList.toggle("dark-mode");
  localStorage.setItem('darkMode', document.body.classList.contains('dark-mode'));
}

function showNotif(text){
  let notif=document.createElement("div");
  notif.className="notif"; notif.innerText=text;
  document.getElementById("notifications").appendChild(notif);
  setTimeout(()=>notif.classList.add("show"),50);
  setTimeout(()=>notif.classList.remove("show"),2000);
  setTimeout(()=>notif.remove(),2500);
}


fetchPosts();
</script>
</body>
</html>
